<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create New Post - Admin v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#ff4f00',
                        'brand-yellow': '#ffcf00',
                        'brand-blue': '#89bbfe'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a !important; }
        .orange-border { border: 4px solid #ff4f00 !important; }
        .orange-border:focus { border-color: #ff6600 !important; box-shadow: 0 0 0 4px rgba(255, 79, 0, 0.2) !important; }
    </style>
</head>
<body class="min-h-screen bg-neutral-900 text-white">
    
    <!-- Header -->
    <header class="bg-neutral-800 border-b border-neutral-700 p-4">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <h1 class="text-2xl font-bold text-orange-400">Create New Post - Admin v2.0</h1>
            <a href="/admin/" class="bg-neutral-700 hover:bg-neutral-600 px-4 py-2 rounded text-sm">‚Üê Dashboard</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-6">
        
        <!-- Post Creation Form -->
        <div class="bg-neutral-800 rounded-lg p-8 shadow-xl border-4 border-orange-500">
            
            <form id="postForm" class="space-y-6">
                
                <!-- Post Slug with Preview -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Post Slug</label>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-neutral-300 bg-neutral-700 px-3 py-2 rounded" id="slugPrefix">/2025/10/</span>
                        <input name="slug" required placeholder="my-awesome-post" 
                               class="flex-1 orange-border rounded-lg px-4 py-2 text-white bg-neutral-700"
                               oninput="updateSlugPreview()">
                    </div>
                    <p class="mt-2 text-sm font-bold text-orange-600" id="fullSlugPreview">Full URL: /2025/10/my-awesome-post</p>
                </div>

                <!-- Date and Title -->
                <div class="grid gap-6 md:grid-cols-2">
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Publish Date</label>
                        <input name="date" type="date" 
                               class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-700"
                               onchange="updateSlugPrefix()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Post Title</label>
                        <input name="title" required placeholder="Enter your post title" 
                               class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-700"
                               oninput="generateSlugFromTitle()">
                    </div>
                </div>

                <!-- Tags and Categories -->
                <div class="grid gap-6 md:grid-cols-2">
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Tags</label>
                        <input name="tags" placeholder="AI, automation, technology" 
                               class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-700">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Categories</label>
                        <input name="categories" placeholder="Technology, Business" 
                               class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-700">
                    </div>
                </div>

                <!-- Featured Image -->
                <div class="bg-neutral-700 rounded-lg p-4 border-2 border-purple-500">
                    <h3 class="text-lg font-semibold text-purple-400 mb-3">üñºÔ∏è Featured Image</h3>
                    
                    <!-- Image Upload -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Upload Image</label>
                        <div class="flex items-center gap-3">
                            <input type="file" id="imageFile" accept="image/*" 
                                   class="hidden" onchange="handleImageUpload(event)">
                            <button type="button" onclick="document.getElementById('imageFile').click()" 
                                    class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm font-medium text-white transition-colors">
                                üìÅ Choose Image
                            </button>
                            <span id="fileName" class="text-sm text-neutral-400">No file selected</span>
                        </div>
                        <p class="text-xs text-neutral-400 mt-1">Supported: JPG, PNG, WebP (max 5MB)</p>
                    </div>
                    
                    <!-- Image Preview -->
                    <div id="imagePreview" class="hidden mb-4">
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Preview</label>
                        <div class="relative">
                            <img id="previewImg" src="" alt="Preview" class="max-w-full h-48 object-cover rounded-lg border-2 border-neutral-600">
                            <button type="button" onclick="clearImageUpload()" 
                                    class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    
                    <!-- Manual URL Input -->
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Or Enter Image URL</label>
                        <input name="image" id="imageUrl" placeholder="/images/2025/10/my-post-image.webp" 
                               class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800"
                               oninput="updateImagePreviewFromUrl()">
                        <p class="text-xs text-neutral-400 mt-1">Optional: Direct URL to existing image</p>
                    </div>
                </div>

                <!-- Summary -->
                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-2">Summary/Excerpt</label>
                    <textarea name="excerpt" rows="3" placeholder="Brief description of your post..." 
                              class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-700"></textarea>
                </div>

                <!-- Content -->
                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-2">Post Content</label>
                    <textarea name="content" rows="10" placeholder="Write your post content in Markdown..." 
                              class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-700 font-mono text-sm"></textarea>
                </div>

                <!-- Social Post Options -->
                <div class="bg-neutral-700 rounded-lg p-4 border-2 border-blue-500">
                    <h3 class="text-lg font-semibold text-blue-400 mb-3">üì£ Social Media Post</h3>
                    <div class="grid gap-6 md:grid-cols-2">
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Social Caption</label>
                            <textarea name="social_caption" rows="4" placeholder="Short caption for social media..." 
                                      class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800"></textarea>
                            <p class="text-xs text-neutral-400 mt-1">Tip: Keep under typical limits (e.g., 280 chars for X).</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Link URL</label>
                            <input name="social_link" placeholder="https://mgrnz.com/posts/your-post/" 
                                   class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                            <label class="block text-sm font-medium text-neutral-300 mt-4 mb-2">Hashtags</label>
                            <input name="social_hashtags" placeholder="#AI, #Automation" 
                                   class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-neutral-300 mb-2">Platforms</label>
                        <select name="social_platforms" id="socialPlatforms" multiple 
                                class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                            <option value="x">X / Twitter</option>
                            <option value="facebook_page">Facebook Page</option>
                            <option value="linkedin_page">LinkedIn Page</option>
                            <option value="instagram">Instagram</option>
                            <option value="threads">Threads</option>
                            <option value="youtube_community">YouTube Community</option>
                        </select>
                        <p class="text-xs text-neutral-400 mt-1">Hold Ctrl/Cmd to select multiple platforms.</p>
                    </div>
                </div>

                <!-- Scheduling -->
                <div class="bg-neutral-700 rounded-lg p-4 border-2 border-teal-500">
                    <h3 class="text-lg font-semibold text-teal-300 mb-3">üóìÔ∏è Scheduling</h3>
                    <label class="inline-flex items-center gap-2">
                        <input id="scheduleEnabled" type="checkbox" class="rounded border-neutral-500"> 
                        <span class="text-neutral-200 text-sm">Schedule this post (blog + selected social)</span>
                    </label>
                    <div id="scheduleFields" class="grid gap-6 md:grid-cols-3 mt-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Date</label>
                            <input name="schedule_date" type="date" class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Time</label>
                            <input name="schedule_time" type="time" class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Timezone</label>
                            <select name="schedule_tz" class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                                <option value="Pacific/Auckland">Pacific/Auckland (NZ)</option>
                                <option value="UTC">UTC</option>
                                <option value="Pacific/Australia">Australia/Sydney</option>
                                <option value="America/Los_Angeles">America/Los_Angeles</option>
                                <option value="America/New_York">America/New_York</option>
                                <option value="Europe/London">Europe/London</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- GitHub Token Section -->
                <div id="tokenSection" class="bg-neutral-700 rounded-lg p-4 border-2 border-yellow-500">
                    <h3 class="text-lg font-semibold text-yellow-400 mb-3">üîë GitHub Authentication</h3>
                    <div class="space-y-3">
                        <div id="tokenStatus" class="text-sm">
                            <span id="tokenStatusText" class="text-neutral-300">Checking for saved token...</span>
                        </div>
                        <div id="tokenInput" class="hidden">
                            <label class="block text-sm font-medium text-neutral-300 mb-2">GitHub Personal Access Token</label>
                            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" 
                                   class="w-full orange-border rounded-lg px-4 py-2 text-white bg-neutral-800">
                            <p class="text-xs text-neutral-400 mt-1">
                                Create one at: <a href="https://github.com/settings/tokens" target="_blank" class="text-blue-400 hover:underline">github.com/settings/tokens</a> with "repo" scope
                            </p>
                            <button type="button" onclick="saveToken()" class="mt-2 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm">
                                üíæ Save Token
                            </button>
                        </div>
                        <button type="button" id="clearTokenBtn" onclick="clearToken()" class="hidden text-red-400 hover:text-red-300 text-sm">
                            üóëÔ∏è Clear Saved Token
                        </button>
                    </div>
                </div>

                <!-- Submit -->
                <div class="pt-6">
                    <button type="submit" id="submitBtn" disabled
                            class="w-full bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-4 px-6 rounded-lg text-lg transition-all cursor-not-allowed">
                        üîí Enter GitHub Token First
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        // Set default date
        const today = new Date();
        document.querySelector('input[name="date"]').value = today.toISOString().slice(0,10);
        updateSlugPrefix();
        
        // Toggle schedule fields
        const scheduleEnabledEl = document.getElementById('scheduleEnabled');
        const scheduleFieldsEl = document.getElementById('scheduleFields');
        if (scheduleEnabledEl && scheduleFieldsEl) {
            scheduleEnabledEl.addEventListener('change', () => {
                if (scheduleEnabledEl.checked) {
                    scheduleFieldsEl.classList.remove('hidden');
                } else {
                    scheduleFieldsEl.classList.add('hidden');
                }
            });
        }

        // Check for saved GitHub token on page load
        checkGitHubToken();

        // Slug functions
        function updateSlugPrefix() {
            const dateInput = document.querySelector('input[name="date"]');
            const slugPrefix = document.getElementById('slugPrefix');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value + 'T00:00:00');
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                slugPrefix.textContent = `/${year}/${month}/`;
                updateSlugPreview();
            }
        }

        function updateSlugPreview() {
            const slugPrefix = document.getElementById('slugPrefix').textContent;
            const slugInput = document.querySelector('input[name="slug"]');
            const preview = document.getElementById('fullSlugPreview');
            
            const slug = slugInput.value || 'my-awesome-post';
            preview.textContent = `Full URL: ${slugPrefix}${slug}`;
        }

        function generateSlugFromTitle() {
            const titleInput = document.querySelector('input[name="title"]');
            const slugInput = document.querySelector('input[name="slug"]');
            
            if (titleInput.value && !slugInput.value) {
                const slug = titleInput.value
                    .toLowerCase()
                    .replace(/[^a-z0-9\s-]/g, '')
                    .replace(/\s+/g, '-')
                    .replace(/-+/g, '-')
                    .trim();
                
                slugInput.value = slug;
                updateSlugPreview();
            }
        }

        // Form submission with GitHub API
        document.getElementById('postForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            
            // Show loading state
            submitButton.innerHTML = '‚è≥ Creating Post...';
            submitButton.disabled = true;
            
            try {
                const formData = new FormData(this);
                const date = formData.get('date');
                const slug = formData.get('slug');
                const title = formData.get('title');
                const tags = formData.get('tags');
                const categories = formData.get('categories');
                const image = formData.get('image');
                const excerpt = formData.get('excerpt');
                const content = formData.get('content');
                
                // Generate folder name
                const dateObj = new Date(date + 'T00:00:00');
                const year = dateObj.getFullYear();
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const folderName = `${slug}`;
                
                // Gather social + scheduling
                const socialCaption = formData.get('social_caption') || '';
                const socialLink = formData.get('social_link') || '';
                const socialHashtags = formData.get('social_hashtags') || '';
                const selectedPlatforms = Array.from(document.getElementById('socialPlatforms')?.selectedOptions || []).map(o => o.value);

                const scheduleEnabled = document.getElementById('scheduleEnabled')?.checked || false;
                const scheduleDate = formData.get('schedule_date') || '';
                const scheduleTime = formData.get('schedule_time') || '';
                const scheduleTz = formData.get('schedule_tz') || '';

                if (scheduleEnabled && (!scheduleDate || !scheduleTime)) {
                    throw new Error('Scheduling is enabled but date/time are missing.');
                }

                // Generate markdown content
                let markdown = '---\n';
                markdown += `title: "${title.replace(/"/g, '\\"')}"\n`;
                markdown += `date: ${date}\n`;
                markdown += `draft: false\n`;
                
                if (tags) {
                    const tagArray = tags.split(',').map(t => `"${t.trim().replace(/"/g, '\\"')}"`).join(', ');
                    markdown += `tags: [${tagArray}]\n`;
                }
                
                if (categories) {
                    const catArray = categories.split(',').map(c => `"${c.trim().replace(/"/g, '\\"')}"`).join(', ');
                    markdown += `categories: [${catArray}]\n`;
                }
                
                if (image) {
                    markdown += `image: "${image.replace(/"/g, '\\"')}"\n`;
                }
                
                if (excerpt) {
                    markdown += `summary: "${excerpt.replace(/"/g, '\\"')}"\n`;
                }
                
                // Social metadata
                if (selectedPlatforms.length > 0 || socialCaption || socialLink || socialHashtags) {
                    markdown += 'social:\n';
                    if (selectedPlatforms.length > 0) {
                        markdown += `  platforms: [${selectedPlatforms.map(p => `"${p}"`).join(', ')}]\n`;
                    }
                    if (socialCaption) markdown += `  caption: "${socialCaption.replace(/"/g, '\\"')}"\n`;
                    if (socialLink) markdown += `  link: "${socialLink.replace(/"/g, '\\"')}"\n`;
                    if (socialHashtags) markdown += `  hashtags: "${socialHashtags.replace(/"/g, '\\"')}"\n`;
                }

                // Scheduling metadata
                if (scheduleEnabled) {
                    const iso = new Date(`${scheduleDate}T${scheduleTime}:00`).toISOString();
                    markdown += 'schedule:\n';
                    markdown += `  enabled: true\n`;
                    markdown += `  at: "${iso}"\n`;
                    if (scheduleTz) markdown += `  timezone: "${scheduleTz}"\n`;
                }

                markdown += '---\n\n';
                markdown += content || '# ' + title + '\n\nYour post content goes here.\n\n---\n\n<div style="text-align: center; margin: 30px 0;">\n<' + 'script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="mgrnz" data-color="#ff6905" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#FFDD00" ></' + 'script>\n</div>';
                
                // Get GitHub token
                const token = localStorage.getItem('github_token');
                if (!token) {
                    throw new Error('GitHub token is required to create posts');
                }
                
                // Upload image first if one is selected
                if (window.selectedImageFile) {
                    submitButton.innerHTML = 'üì§ Uploading Image...';
                    try {
                        await uploadImageToGitHub(window.selectedImageFile, window.selectedImageFile.path);
                        console.log('Image uploaded successfully');
                    } catch (error) {
                        throw new Error(`Image upload failed: ${error.message}`);
                    }
                }
                
                // Create post via GitHub API
                const owner = 'captjreacher';
                const repo = 'mgrnz-blog';
                const branch = 'main';
                const filePath = `content/posts/${folderName}/index.md`;
                
                submitButton.innerHTML = 'üì§ Uploading to GitHub...';
                
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Create new post: ${title}`,
                        content: btoa(unescape(encodeURIComponent(markdown))),
                        branch: branch
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (response.status === 401 || response.status === 403) {
                        localStorage.removeItem('github_token');
                        throw new Error('Invalid GitHub token. Please try again with a fresh token.');
                    }
                    if (response.status === 422 && errorData.message && errorData.message.includes('already exists')) {
                        throw new Error(`Post with slug "${slug}" already exists. Please use a different slug.`);
                    }
                    throw new Error(errorData.message || `GitHub API error: ${response.status} - ${response.statusText}`);
                }
                
                submitButton.innerHTML = 'üéâ Post Created Successfully!';
                
                // Show success message
                alert(`‚úÖ Post "${title}" created successfully!\n\nüöÄ GitHub Actions will rebuild your site automatically.\n\nYour post will be live in a few minutes at:\n/posts/${folderName}/`);
                
                // Reset form
                this.reset();
                document.querySelector('input[name="date"]').value = new Date().toISOString().slice(0,10);
                updateSlugPrefix();
                updateSlugPreview();
                
                // Redirect to posts management
                setTimeout(() => {
                    window.location.href = '/admin/posts/';
                }, 2000);
                
            } catch (error) {
                console.error('Error creating post:', error);
                alert(`‚ùå Error creating post:\n\n${error.message}\n\nPlease try again or check your GitHub token.`);
                
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });

        // GitHub Token Management Functions
        function checkGitHubToken() {
            const token = localStorage.getItem('github_token');
            const statusText = document.getElementById('tokenStatusText');
            const tokenInput = document.getElementById('tokenInput');
            const clearTokenBtn = document.getElementById('clearTokenBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            if (token) {
                statusText.innerHTML = '‚úÖ <span class="text-green-400">GitHub token saved and ready</span>';
                tokenInput.classList.add('hidden');
                clearTokenBtn.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.className = 'w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-4 px-6 rounded-lg text-lg transition-all';
                submitBtn.innerHTML = 'üöÄ Create Post Package';
            } else {
                statusText.innerHTML = '‚ö†Ô∏è <span class="text-yellow-400">GitHub token required</span>';
                tokenInput.classList.remove('hidden');
                clearTokenBtn.classList.add('hidden');
                submitBtn.disabled = true;
                submitBtn.className = 'w-full bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-4 px-6 rounded-lg text-lg transition-all cursor-not-allowed';
                submitBtn.innerHTML = 'üîí Enter GitHub Token First';
            }
        }
        
        function saveToken() {
            const tokenInput = document.getElementById('githubToken');
            const token = tokenInput.value.trim();
            
            if (!token) {
                alert('Please enter a valid GitHub token');
                return;
            }
            
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                if (!confirm('This doesn\'t look like a GitHub Personal Access Token. Continue anyway?')) {
                    return;
                }
            }
            
            localStorage.setItem('github_token', token);
            tokenInput.value = '';
            checkGitHubToken();
            alert('‚úÖ GitHub token saved successfully!');
        }
        
        function clearToken() {
            if (confirm('Are you sure you want to clear the saved GitHub token?')) {
                localStorage.removeItem('github_token');
                checkGitHubToken();
                alert('üóëÔ∏è GitHub token cleared');
            }
        }

        // Image Upload Functions
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please select a valid image file (JPG, PNG, or WebP)');
                return;
            }
            
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image file must be smaller than 5MB');
                return;
            }
            
            // Update file name display
            document.getElementById('fileName').textContent = file.name;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImg = document.getElementById('previewImg');
                const imagePreview = document.getElementById('imagePreview');
                
                previewImg.src = e.target.result;
                imagePreview.classList.remove('hidden');
                
                // Generate suggested path
                const date = new Date();
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const fileName = file.name.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
                const suggestedPath = `/images/${year}/${month}/${fileName}`;
                
                // Update URL input
                document.getElementById('imageUrl').value = suggestedPath;
                
                // Store file data for upload
                window.selectedImageFile = {
                    file: file,
                    path: suggestedPath,
                    data: e.target.result
                };
            };
            reader.readAsDataURL(file);
        }
        
        function clearImageUpload() {
            document.getElementById('imageFile').value = '';
            document.getElementById('fileName').textContent = 'No file selected';
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('imageUrl').value = '';
            window.selectedImageFile = null;
        }
        
        function updateImagePreviewFromUrl() {
            const url = document.getElementById('imageUrl').value;
            if (url && (url.startsWith('/images/') || url.startsWith('http'))) {
                const previewImg = document.getElementById('previewImg');
                const imagePreview = document.getElementById('imagePreview');
                
                previewImg.src = url;
                imagePreview.classList.remove('hidden');
                
                // Clear file upload if URL is manually entered
                if (!window.selectedImageFile || window.selectedImageFile.path !== url) {
                    document.getElementById('imageFile').value = '';
                    document.getElementById('fileName').textContent = 'No file selected';
                    window.selectedImageFile = null;
                }
            }
        }
        
        // Upload image to GitHub
        async function uploadImageToGitHub(imageFile, imagePath) {
            const token = localStorage.getItem('github_token');
            if (!token) {
                throw new Error('GitHub token required for image upload');
            }
            
            // Convert file to base64
            const base64Data = imageFile.data.split(',')[1]; // Remove data:image/...;base64, prefix
            
            try {
                const response = await fetch(`https://api.github.com/repos/captjreacher/mgrnz-blog/contents/static${imagePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Add image: ${imagePath}`,
                        content: base64Data,
                        branch: 'main'
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `Failed to upload image: ${response.status}`);
                }
                
                return true;
            } catch (error) {
                console.error('Image upload error:', error);
                throw error;
            }
        }
    </script>
</body>
</html>